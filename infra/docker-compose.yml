version: '3.8'

services:
  ingestion-indexer:
    build:
      context: .
      dockerfile: services/ingestion-indexer/Dockerfile
    env_file:
      - ../.env
      - ../.env.example
    ports:
      - "8001:8001"
    volumes:
      - ./data:/app/data
      - ./services:/app/services
      - ./config.yaml:/app/config.yaml
    command: uvicorn services.ingestion-indexer.main:app --host 0.0.0.0 --port 8001 --reload

  chat-orchestrator:
    build:
      context: .
      dockerfile: services/chat-orchestrator/Dockerfile
    env_file:
      - ../.env
      - ../.env.example
    ports:
      - "8002:8002"
    environment:
      - GROK_KEY=${GROK_KEY}
      - GEMINI_KEY=${GEMINI_KEY}
    volumes:
      - ./services:/app/services
      - ./config.yaml:/app/config.yaml
    command: uvicorn services.chat-orchestrator.main:app --host 0.0.0.0 --port 8002 --reload
    depends_on:
      - ingestion-indexer

  gateway-api:
    build:
      context: .
      dockerfile: services/gateway-api/Dockerfile
    env_file:
      - ../.env
      - ../.env.example
    ports:
      - "8000:8000"
    volumes:
      - ./services:/app/services
      - ./config.yaml:/app/config.yaml
    command: uvicorn services.gateway-api.main:app --host 0.0.0.0 --port 8000 --reload
    depends_on:
      - chat-orchestrator

#  email-responder:
#    build:
#      context: .
#      dockerfile: services/email-responder/Dockerfile
#    volumes:
#      - ./services:/app/services
#      - ./config.yaml:/app/config.yaml
#    command: python services/email-responder/worker.py
